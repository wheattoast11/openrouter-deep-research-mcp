# OpenRouter Agents v2.1 Environment Configuration
# Copy this file to .env and adjust values as needed

# Server Configuration
SERVER_PORT=3008
SERVER_API_KEY=your-api-key-here
ALLOW_NO_API_KEY=false
PUBLIC_URL=http://localhost:3008
REQUIRE_HTTPS=false
BIND_ADDRESS=0.0.0.0

# Mode Configuration (v2.1)
MODE=AGENT                    # AGENT | MANUAL | ALL (defaults to AGENT in v2.1)

# Feature Flags (v2.1 - safe defaults)
ZERO_ORCHESTRATOR=true        # Enable single-agent zero orchestrator
ASYNC_JOBS=true              # Enable async job processing
WS_STREAMING_ENABLED=true    # Enable WebSocket streaming

# @terminals-tech Integrations (with fallbacks)
TERMINALS_TECH_EMBEDDINGS=true  # Enable @terminals-tech/embeddings
TERMINALS_TECH_GRAPH=true       # Enable @terminals-tech/graph
GRAPH_ENRICHMENT_ENABLED=true   # Enable query expansion via graph

# Security Features (enabled by default)
OAUTH_ENABLED=true           # Enable OAuth JWT validation
RATE_LIMITING=true          # Enable express rate limiting
SECURITY_HEADERS=true       # Enable security headers middleware

# Advanced Features (disabled by default for stability)
TOOL_CALL_STREAMING=true     # Enable tool output streaming
RESOURCE_SUBSCRIPTIONS=true  # Enable MCP resource subscriptions
PROMPT_SUBSCRIPTIONS=true    # Enable MCP prompt subscriptions

# Development Features (disabled by default)
DEBUG_MODE=false            # Enhanced logging
EXPERIMENTAL_FEATURES=false # Unstable features

# Authentication (OAuth 2.1 Resource Server)
AUTH_JWKS_URL=https://your-auth-provider.com/.well-known/jwks.json
AUTH_EXPECTED_AUD=mcp-server
AUTH_ISSUER_URL=https://your-auth-provider.com
AUTH_DISCOVERY_ENABLED=true
AUTH_SERVERS=https://your-auth-provider.com
AUTH_SCOPES_MINIMAL=mcp:read,mcp:tools:list,mcp:resources:list,mcp:prompts:list

# API Keys (REQUIRED for agent-mode operation)
# OpenRouter API key for planning/research/synthesis LLM calls
# Get your key from: https://openrouter.ai/keys
OPENROUTER_API_KEY=your-openrouter-key-here

# Optional: Gemini/Google API keys for alternative providers
GEMINI_API_KEY=your-gemini-key
GOOGLE_API_KEY=your-google-key

# Database Configuration
PGLITE_DATA_DIR=./researchAgentDB

# Caching Configuration
CACHE_TTL_SECONDS=3600

# Indexer Configuration
INDEXER_WEIGHTS_BM25=0.7
INDEXER_WEIGHTS_VECTOR=0.3
INDEXER_STOPWORDS=
INDEXER_RERANK_ENABLED=false

# MCP Configuration
MCP_ENABLE_PROMPTS=true
MCP_ENABLE_RESOURCES=true
MCP_STREAMABLE_HTTP_ENABLED=true
MCP_STDIO_ENABLED=true
MCP_WEBSOCKET_ENABLED=true
MCP_PROTOCOL_VERSION=2025-03-26
MCP_SUPPORTED_VERSIONS="2024-11-05,2025-03-26,2025-06-18"
MCP_SESSION_TIMEOUT_SECONDS=3600
MCP_SESSION_CLEANUP_INTERVAL_SECONDS=600

# Local Models Configuration (Server-side GGUF inference)
LOCAL_MODELS_ENABLED=false
# Comma-separated list of HuggingFace model IDs (format: repo/model:quantization)
# Example: mradermacher/utopia-atomic-GGUF:Q2_K,mradermacher/Qwen3-4B-Thinking-2507-Esper3.1-i1-GGUF
LOCAL_MODEL_IDS=
LOCAL_MODELS_DOWNLOAD_PATH=./models

# A2A Connectors (feature-flagged, disabled by default)
MCP_CONNECTOR_X402_ENABLED=false
MCP_CONNECTOR_AP2_ENABLED=false

# Logging
LOG_LEVEL=info

# Security Configuration
ALLOWED_ORIGINS=http://localhost:*,https://localhost:*
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# Experimental Modes
HYPER_MODE=false

# ============================================================================
# BETA FEATURES (v2.1.1-beta)
# ============================================================================
# Master switch for all beta features (PLL streaming, compression policies)
# When BETA_FEATURES=true: PLL and compression are ENABLED by default (opt-out)
# When BETA_FEATURES=false: Stable v2.1 behavior, all beta features DISABLED
# ⚠️  Set BETA_FEATURES=false for production-stable v2.1 behavior
BETA_FEATURES=true

# Phase-Locked Loop (PLL) Streaming Policies
# Adaptive concurrency control with real-time telemetry
# Only active when BETA_FEATURES=true (unless explicitly overridden)
PLL_ENABLE=true
PLL_TARGET_TOKEN_RATE=32
PLL_MAX_FANOUT=6
PLL_MAX_CONCURRENCY=6
PLL_JITTER_TOLERANCE_MS=180
PLL_GAIN=0.5
PLL_SMOOTHING_HALFLIFE_MS=320
PLL_CIRCUIT_BREAKER_THRESHOLD=6
PLL_FALLBACK_COOLDOWN_MS=10000

# Compression Policies
# Context/KV cache budget enforcement with entropy scoring
# Only active when BETA_FEATURES=true (unless explicitly overridden)
COMPRESSION_ENABLE=true
COMPRESSION_TARGET_TOKENS=3200
COMPRESSION_MIN_RETENTION_RATIO=0.35
COMPRESSION_ENTROPY_FLOOR=0.2